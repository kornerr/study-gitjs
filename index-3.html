<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Attempt 3</title>
    <style>
      #repo {
        display: none;
      }
      #repo-div {
        display: flex;
      }
      #repo-url {
        flex: 1;
        margin-right: 1em;
      }
    </style>
  </head>
  <body>
    <form id="repo">
      <fieldset>
        <legend>Select chat repository</legend>
        <div id="repo-div">
          <input id="repo-url" name="repo-url" type="text" placeholder="For example: https://git.opengamestudio.org/kornerr/study-gitjs-access"/>
          <input id="repo-accept" type="submit" value="Accept" />
        </div>
      </fieldset>
    </form>
    <!-- Dependencies -->
		<script src="lightning-fs-3.3.6.min.js"></script>
    <script src="isomorphic-git-0.70.7-bundle.umd.min.js"></script>
    <!-- Global entities and constants -->
    <script>
      window.fs = new LightningFS("STORAGE-attempt3");
      git.plugins.set("fs", window.fs);
      window.pfs = window.fs.promises;

      window.DIR_REL = "attempt3";
      window.DIR = "/" + DIR_REL;
      window.ERR_GIT_CLONE_FAILED = "Failed to clone repository";
      window.PROXY = "https://vercel-cors-proxy-pi.vercel.app";
    </script>
    <!-- Global reusable functions -->
    <script>
      // Get element by id.
      function deId(sid) {
        return document.getElementById(sid);
      }

      // Report error with an alert.
      function reportError(title, err) {
        alert(title + "\n\n" + err.name + ": " + err.message);
      }

      // List files recursively.
      async function walkFiles(path, indent) {
          if (indent == null) {
              indent = 0;
          }
          var files = await pfs.readdir(path)
          for (var i in files) {
              var sindent = ""
              for (k = 0; k < indent; ++k) {
                  sindent += ">";
              }
              var f = files[i];
              console.log(`${sindent}${f}`);
              var fullPath = path + "/" + f;
              var st = fs.stat(fullPath);
              console.log("st", st);
              //if (st.type == "dir") {
                  await walkFiles(fullPath, indent + 1);
              //}
          }
      }
    </script>
    <!-- Tasks -->
    <script src="DoRequestRepo.js"></script>
    <!-- Run tasks -->
    <script>
      var tasks = [
        new DoRequestRepo(deId("repo"), deId("repo-accept"), deId("repo-url")),
      ];
      for (const i in tasks) {
        var task = tasks[i];
        task.execute();
      }
    </script>
  </body>
</html>
