<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Repeat 0.70.7 code</title>
  </head>
  <body>
	<script src="lightning-fs-3.3.6.min.js"></script>
  <script src="isomorphic-git-0.70.7-bundle.umd.min.js"></script>
  <!-- Start -->
  <script>
    async function run() {
      window.fs = new LightningFS("STORAGE-study-git");
      git.plugins.set("fs", window.fs);
      window.pfs = window.fs.promises;
      window.dirRel = "tutorial";
      window.dir = "/" + dirRel;
      var contents01 = await pfs.readdir("/");
      console.log("01. root:", contents01);
      if (!contents01.includes(dirRel)) {
        await pfs.mkdir(dir);
      }
      var contents02 = await pfs.readdir(dir)
      console.log(`02 ${dir}:`, contents02);

      if (!contents01.includes(dirRel)) {
        await git.clone({
          dir,
          corsProxy: "https://vercel-cors-proxy-pi.vercel.app",
          url: "https://git.opengamestudio.org/kornerr/study-gitjs-access",
          ref: "main",
          singleBranch: true,
          depth: 1
        });
      }
      var contents03 = await pfs.readdir(dir)
      console.log(`03 ${dir}:`, contents03);

      var contents04 = await pfs.readFile(dir + "/chat.log", {encoding: "utf8"});
      console.log(`04 ${dir}/chat.log:`, contents04);

      contents04 += `\n${Date()}: Added from JS`;

      await pfs.writeFile(dir + "/chat.log", contents04, {encoding: "utf8"});
      var contents05 = await pfs.readFile(dir + "/chat.log", {encoding: "utf8"});
      console.log(`05 ${dir}/chat.log:`, contents05);

      await git.add({dir, filepath: "chat.log"});
      await git.commit({dir, message: "From JS", author: {name: "JS", email: "gitjs.org"}});

    }

    run()
	</script>
</html>
