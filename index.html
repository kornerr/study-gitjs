<html>
  <head>
    <title>Check isomorphic-git 0.70.7 and lightning fs 3.3.6</title>
  </head>
  <body>
  </body>
	<script src="lightning-fs-3.3.6.min.js"></script>
	<script src="isomorphic-git-0.70.7-bundle.umd.min.js"></script>

  <!-- Setup -->
	<script>
    var CORS_PROXY = "https://vercel-cors-proxy-pi.vercel.app";
    var REPO_BRANCH = "main";
    var REPO_URL = "https://git.opengamestudio.org/kornerr/study-gitjs-access";

    async function checkIsomorphic() {
      // Initialize isomorphic-git with a file system
      // WIPE clean each run
      window.fs = new LightningFS('fs', {wipe: true})
      git.plugins.set('fs', window.fs)
      window.pfs = window.fs.promises

      window.dir = '/tutorial';
      console.log("01", dir);
      await pfs.mkdir(dir);
      console.log("02", dir);
      // Behold - it is empty!
      var files = await pfs.readdir(dir);
      console.log("03 before:", files);

      await git.clone({
        dir,
        corsProxy: CORS_PROXY,
        url: REPO_URL,
        ref: REPO_BRANCH,
        singleBranch: true,
        depth: 1
      });

      // Now it should not be empty...
      files = await pfs.readdir(dir);
      console.log("04 after:", files);
      var logs = await git.log({dir});
      console.log("05 logs:", logs);
    }

  </script>

  <!-- Start -->
  <script>
    checkIsomorphic()
	</script>
</html>
