<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Study GitJS 2025-03-25</title>
    <style>
      legend {
        color: lightgrey;
      }
      fieldset {
        border: 1px solid lightgrey;
      }
      input {
        padding: 0.5em;
        margin: 0.5em;
      }
      #message {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <form>
      <fieldset>
        <legend>Authentication</legend>
        <div>
          <label for="username">Username:</label>
          <input id="username" name="username" type="text" />
        </div>
        <div>
          <label for="password">Password:</label>
          <input id="password" name="password" type="password" />
        </div>
        <div>
          <label for="branch">Branch:</label>
          <input id="branch" name="branch" type="text" />
        </div>
      </fieldset>
    </form>
    <form onsubmit="event.preventDefault(); doSend();">
      <fieldset>
        <legend>Send message</legend>
        <input id="message" name="message" type="text" />
        <input id="send" type="submit" value="Send" />
      </fieldset>
    </form>
    <form>
      <fieldset>
        <legend>Previous N messages</legend>
        <ul>
          <li>todo-1..</li>
          <li>todo-2..</li>
        </ul>
      </fieldset>
    </form>
  </body>
	<script src="lightning-fs-3.3.6.min.js"></script>
	<script src="isomorphic-git-0.70.7-bundle.umd.min.js"></script>
	<script src="constants.js"></script>
	<script src="check.js"></script>
	<script src="other.js"></script>
  <!-- Start -->
  <script>
    async function runChat() {
      const fs = await createFileSystem(FS_STORAGE_NAME);

      var files = await fs.readdir("/");
      console.log("01. Files:", files);

      if (files.length == 0) {
        console.log("02-1. Clone");
        await clone(REPO_URL, REPO_BRANCH);
      } else {
        console.log("02-2. Pull");
        await pull(REPO_URL, REPO_BRANCH);
      }

      files = await fs.readdir("/");
      console.log("03. Files:", files);

      var contents = ""
      if (files.includes(FILE_CHAT_LOG)) {
        contents = await fs.readFile(FILE_CHAT_LOG, {encoding: "utf8"});
      }
      console.log("04. Contents:", contents);
    }

    async function sendMessage(priorContents, newMessage) {
      var contents = priorContents + "/n/n" + newMessage;
      var enc = new TextEncoder().encode(contents);
      await fs.writeFile(FILE_CHAT_LOG, {encoding: "utf8"});
      await add(REPO_URL, REPO_BRANCH);
      await push(REPO_URL, REPO_BRANCH);
    }

    runChat()
	</script>
</html>
